# Контекст проекта для AI

Этот файл содержит подробную информацию о проекте для лучшего понимания контекста AI-ассистентом.

## Описание проекта

**Mod Aggregator** - это десктопное приложение для агрегации модов из различных сайтов. Аналог ModOrganizer/NexusMods с визуальным конструктором парсеров.

## Архитектура

### Frontend (Svelte 5)
- **Фреймворк**: Svelte 5 с TypeScript
- **Стилизация**: Tailwind CSS
- **Граф нод**: @xyflow/svelte для визуального конструктора парсеров
- **Состояние**: Svelte 5 runes ($state, $derived, $effect)

### Backend (Rust + Tauri 2.0)
- **Фреймворк**: Tauri 2.0 для десктопных приложений
- **База данных**: SQLite через SQLx
- **Парсинг**: scraper crate для HTML парсинга
- **HTTP**: reqwest для запросов

## Ключевые компоненты

### Frontend компоненты

1. **App.svelte** - главный компонент, роутинг между страницами
2. **ParserBuilder.svelte** - визуальный конструктор парсеров с нодами
3. **PageViewer.svelte** - просмотр страниц для выбора элементов
4. **ElementSelector.svelte** - выбор элементов на странице
5. **Nodes/** - компоненты нод (Selector, Extract, Filter, Transform, Output)
6. **SitesManager.svelte** - управление сайтами
7. **ModsList.svelte** - список модов
8. **NotificationsPanel.svelte** - панель уведомлений

### Backend модули

1. **database.rs** - работа с SQLite базой данных
2. **parser.rs** - движок парсинга HTML
3. **parser_builder.rs** - построение парсеров из нод
4. **models.rs** - модели данных (Site, Mod, Notification, etc.)
5. **notification.rs** - система уведомлений
6. **parsers/synthira.rs** - готовый парсер для synthira.ru

## Модели данных

### Site
- `id`: уникальный идентификатор
- `name`: название сайта
- `url`: URL сайта
- `parser_config`: JSON конфигурация парсера
- `created_at`, `updated_at`: временные метки

### Mod
- `id`: уникальный идентификатор
- `site_id`: связь с сайтом
- `title`: название мода
- `url`: ссылка на мод
- `version`: версия мода
- `author`: автор
- `description`: описание
- `image_url`: ссылка на изображение
- `changes`: изменения в версии

### ParserNode
- `id`: уникальный идентификатор ноды
- `node_type`: тип ноды (selector, extract, filter, transform, output)
- `config`: JSON конфигурация ноды
- `position`: позиция на графе (x, y)

## Потоки данных

### Парсинг модов
1. Пользователь выбирает сайт в ParserBuilder
2. Загружается страница в PageViewer
3. Пользователь выбирает элементы для парсинга
4. Создаются ноды в графе
5. Генерируется Rust код парсера
6. Парсер сохраняется в конфигурации сайта
7. Парсер используется для извлечения модов

### Обновления модов
1. Фоновая задача проверяет обновления каждые 3600 секунд
2. Для каждого сайта выполняется парсинг
3. Сравниваются версии с базой данных
4. При обнаружении обновлений создаются уведомления
5. Пользователь получает уведомления в NotificationsPanel

## Режимы работы

### Tauri режим (production)
- Полный функционал
- Реальная база данных
- Реальные Tauri команды
- Доступ к файловой системе

### Браузер режим (development)
- Только UI
- Mock данные через tauri-mock.ts
- Быстрая разработка без компиляции Rust
- Автоматическое определение через isTauri()

## Важные паттерны

### Обработка ошибок
- Frontend: try/catch с отображением ошибок пользователю
- Backend: Result<T, String> для всех команд Tauri
- Всегда логируй ошибки через console.error или log crate

### Состояние компонентов
- Используй Svelte 5 runes для реактивности
- Избегай prop drilling, используй события
- Централизуй общее состояние в App.svelte

### Стилизация
- Темная тема по умолчанию
- Основные цвета: #0f172a (фон), #1e293b (панели), #334155 (границы)
- Акцентный цвет: #0ea5e9 (синий)
- Используй Tailwind для утилитарных классов

## API между Frontend и Backend

Все взаимодействие через Tauri команды:
- `get_sites()` - получить список сайтов
- `add_site()` - добавить сайт
- `update_site()` - обновить сайт
- `delete_site()` - удалить сайт
- `get_mods()` - получить список модов
- `check_updates()` - проверить обновления
- `build_parser()` - построить парсер из нод
- `test_parser()` - протестировать парсер
- `fetch_page()` - загрузить страницу для парсинга
- `get_notifications()` - получить уведомления
- `mark_notification_read()` - отметить уведомление как прочитанное

## Тестирование

- Frontend: Vitest + Testing Library
- Тесты находятся в `src/__tests__/` и `src/components/__tests__/`
- Запуск: `npm test`

## Документация

- `README.md` - основная документация
- `BROWSER_MODE.md` - описание браузерного режима
- `SETUP.md` - инструкции по установке
- `LOGGING.md` - логирование
- `COMMIT_MESSAGE.md` - правила коммитов






